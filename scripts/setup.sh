#!/bin/bash

# μ‹¤ν–‰λ μ„μΉλ¥Ό μ°Ύμ•„ μ λ€ κ²½λ΅λ¥Ό μ •μν•©λ‹λ‹¤.
SCRIPT_DIR=$(cd "$(dirname "$0")" && pwd)
PROJECT_ROOT=$(realpath "$SCRIPT_DIR/..")

if [ "$EUID" -ne 0 ]; then
  echo "β μ΄ μ¤ν¬λ¦½νΈλ” κ΄€λ¦¬μ κ¶ν•μΌλ΅ μ‹¤ν–‰λμ–΄μ•Ό ν•©λ‹λ‹¤. 'sudo'λ¥Ό μ‚¬μ©ν•μ—¬ λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”."
  exit 1
fi

echo "π› οΈ μ‹μ¤ν… ν¨ν‚¤μ§€ λ©λ΅μ„ κ°±μ‹ ν•©λ‹λ‹¤..."
if ! apt update -y; then
  echo "β ν¨ν‚¤μ§€ λ©λ΅ κ°±μ‹ μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ„¤νΈμ›ν¬ μ—°κ²°μ„ ν™•μΈν•΄ μ£Όμ„Έμ”."
  exit 1
fi

echo "π› οΈ μ‹¤μµμ— ν•„μ”ν• λ„¤νΈμ›ν¬ λ„κµ¬λ“¤μ„ μ„¤μΉν•©λ‹λ‹¤: dnsutils, tcpdump, curl"
if ! apt install -y dnsutils tcpdump curl; then
  echo "β ν•„μ ν¨ν‚¤μ§€ μ„¤μΉμ— μ‹¤ν¨ν–μµλ‹λ‹¤. μ¤λ¥ λ΅κ·Έλ¥Ό ν™•μΈν•΄ μ£Όμ„Έμ”."
  exit 1
fi
echo "β… ν¨ν‚¤μ§€ μ„¤μΉκ°€ μ™„λ£λμ—μµλ‹λ‹¤!"

echo "π› οΈ λ¨λ“  μ‹¤μµ μ¤ν¬λ¦½νΈμ— μ‹¤ν–‰ κ¶ν•μ„ λ¶€μ—¬ν•©λ‹λ‹¤..."
if ! chmod +x "$PROJECT_ROOT"/scripts/*.sh; then
  echo "β μ¤ν¬λ¦½νΈ μ‹¤ν–‰ κ¶ν• λ¶€μ—¬μ— μ‹¤ν¨ν–μµλ‹λ‹¤."
  echo "β οΈ κ²½λ΅λ¥Ό λ‹¤μ‹ ν™•μΈν•κ±°λ‚, μ¤ν¬λ¦½νΈ νμΌμ΄ μ΅΄μ¬ν•λ”μ§€ ν™•μΈν•΄ μ£Όμ„Έμ”."
  exit 1
fi
echo "β… μ‹¤ν–‰ κ¶ν• λ¶€μ—¬ μ™„λ£!"